Zepto(function(e){function n(e){var n=o.transaction("demo_user","readwrite"),r=n.objectStore("demo_user"),t=r.index("name");t.openCursor().onsuccess=function(n){e(n)}}function r(e){l.validate()&&d.validate()&&n(function(n){var r=n.target.result;if(!r)return void showError(l._el,"用户名不存在！");if(r.key==l.val()&&r.value.isAdmin==e){if(r.value.password==d.val()){var t={name:r.key,userId:r.value.userId,isAdmin:r.value.isAdmin},o="0"==e?"userInfo":"staffInfo";return i.setItem(o,JSON.stringify(t)),void(window.location.href=a)}return void showError(d._el,"密码错误！")}r["continue"]()})}function t(e){l.validate()&&d.validate()&&n(function(n){var r=n.target.result;if(!r){var t=o.transaction("demo_user","readwrite"),i=t.objectStore("demo_user");return void i.add({name:l.val(),password:d.val(),isAdmin:e})}return r.key==l.val()&&r.value.isAdmin==e?void showError(l._el,"该用户已存在!"):void r["continue"]()})}var o={},i=window.localStorage,a="",l={_el:e("#name"),validate:function(){var e=this.val();return e?!0:(showError(this._el,"请输入用户名！"),!1)},val:function(){return this._el.val()}},d={_el:e("#password"),validate:function(){var e=this.val();return e?!0:(showError(this._el,"请输入密码！"),!1)},val:function(){return this._el.val()}},s=e("#rool").val();"1"==s?(a="admin.html",getLoginStaffInfo()&&(window.location.href="admin.html")):(a=getUrlParam("nextUrl")||"myProfile.html",getLoginUserInfo()&&(window.location.href="index.html")),openIndexedDB(function(e){o=e}),e("#addUser").tap(function(){t(s)}),e(".loginBtn").tap(function(){r(s)})});